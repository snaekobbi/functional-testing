<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal"
               xmlns:html="http://www.w3.org/1999/xhtml"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:pef="http://www.daisy.org/ns/2008/pef"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:css="http://www.daisy.org/ns/pipeline/braille-css">
  
  <x:script>
    <p:declare-step type="pxi:css-inline-and-dotify-format" version="1.0">
      <p:input port="source"/>
      <p:output port="result"/>
      <p:option name="stylesheet" required="true"/>
      <p:import href="http://www.daisy.org/pipeline/modules/braille/dotify-formatter/library.xpl"/>
      <p:import href="http://www.daisy.org/pipeline/modules/braille/css-calabash/library.xpl"/>
      <css:inline>
        <p:with-option name="default-stylesheet" select="resolve-uri($stylesheet)"/>
      </css:inline>
      <dotify:format/>
    </p:declare-step>
  </x:script>
  
  <x:scenario id="46.1" label="Top, right, bottom and left margins.">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/47.1/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../46.1/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="file" href="../../resources/47.1/result.pef"/>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="47.1" label="Top, right, bottom and left borders and padding.">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="inline"><doc>
  <body>
    <div>
      ⠿⠿⠿⠿
    </div>
  </body>
</doc>
        </x:document>
      </x:input>
      <x:option name="stylesheet" select="'../47.1/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline"><pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
  <head xmlns:dc="http://purl.org/dc/elements/1.1/">
    <meta>
      <dc:format>application/x-pef+xml</dc:format>
    </meta>
  </head>
  <body>
    <volume rows="5" cols="20" rowgap="0" duplex="false">
      <section>
        <page>
          <row>⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
          <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
          <row>⠀⠇⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠸</row>
          <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
          <row>⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
        </page>
      </section>
    </volume>
  </body>
</pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="66.1" label="Positioning a note at the bottom of the page on which the text surrounding the note is rendered.">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/66.1/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../66.1/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="pef-compare.xpl" step="pxi:pef-compare">
      <x:document type="file" href="../../resources/66.1/result.pef"/>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="66.2" label="Positioning a note at the bottom of the page on which it is being referenced." pending="not implemented yet">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/66.2/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../66.2/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="pef-compare.xpl" step="pxi:pef-compare">
      <x:document type="file" href="../../resources/66.2/result.pef"/>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="66.3" label="Separating the footnotes area from regular text with a horizontal line.">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/66.3/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../66.3/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="pef-compare.xpl" step="pxi:pef-compare">
      <x:document type="file" href="../../resources/66.3/result.pef"/>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="100.1" label="Automatic numbering of footnotes.">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/100.1/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../100.1/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="pef-compare.xpl" step="pxi:pef-compare">
      <x:document type="file" href="../../resources/100.1/result.pef"/>
    </x:expect>
  </x:scenario>
  
  <x:scenario id="100.2" label="Resetting footnote numbers on each page." pending="not implemented yet">
    <x:call step="pxi:css-inline-and-dotify-format">
      <x:input port="source">
        <x:document type="file" href="../../resources/100.2/source.xml"/>
      </x:input>
      <x:option name="stylesheet" select="'../100.2/style.css'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="pef-compare.xpl" step="pxi:pef-compare">
      <x:document type="file" href="../../resources/100.2/result.pef"/>
    </x:expect>
  </x:scenario>
  
</x:description>
